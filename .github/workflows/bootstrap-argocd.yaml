name: Bootstrap ArgoCD Wazuh

on:
  push:
    paths:
      - "k8s/wazuh/wazuh-app.yaml"

jobs:
  bootstrap:
    runs-on: ubuntu-latest

    steps:
    - name: Checkout
      uses: actions/checkout@v4

    - name: Install Tailscale
      uses: tailscale/github-action@v2
      with:
        authkey: ${{ secrets.TAILSCALE_AUTHKEY }}

    - name: Apply ArgoCD Application
      run: |
        ssh -o StrictHostKeyChecking=no \
        ${{ secrets.VM_USER }}@${{ secrets.VM_TAILSCALE_IP }} \
        "sudo k3s kubectl apply -f ~/wazuh-gitops/k8s/wazuh/wazuh-app.yaml"
