apiVersion: kustomize.config.k8s.io/v1beta1
kind: Kustomization

resources:
  # ðŸ”¹ STORAGE (PV + StorageClass ONLY)
  - storage/storage-class.yaml
  - storage/wazuh-manager-pv.yaml
  - storage/wazuh-indexer-pv.yaml

  # ðŸ”¹ BASE
  - base/wazuh-ns.yaml

  # ðŸ”¹ SECRETS
  - secrets/wazuh-api-cred-secret.yaml
  - secrets/wazuh-authd-pass-secret.yaml
  - secrets/wazuh-cluster-key-secret.yaml
  - secrets/dashboard-cred-secret.yaml
  - secrets/indexer-cred-secret.yaml

  # ðŸ”¹ MANAGER
  - wazuh_managers/wazuh-manager-pvc.yaml
  - wazuh_managers/wazuh-cluster-svc.yaml
  - wazuh_managers/wazuh-events-svc.yaml
  - wazuh_managers/wazuh-registration-svc.yaml
  - wazuh_managers/wazuh-api-svc.yaml
  - wazuh_managers/wazuh-master-sts.yaml

  # ðŸ”¹ INDEXER
  - indexer_stack/wazuh-indexer/indexer-svc.yaml
  - indexer_stack/wazuh-indexer/indexer-http-svc.yaml
  - indexer_stack/wazuh-indexer/cluster/indexer-sts.yaml

  # ðŸ”¹ DASHBOARD
  - indexer_stack/wazuh-dashboard/dashboard-deploy.yaml
  - indexer_stack/wazuh-dashboard/dashboard-ingress.yaml
  - indexer_stack/wazuh-dashboard/dashboard-svc.yaml

secretGenerator:
  - name: indexer-certs
    files:
      - wazuh-certificates/root-ca.pem
      - wazuh-certificates/indexer.pem
      - wazuh-certificates/indexer-key.pem
      - wazuh-certificates/dashboard.pem
      - wazuh-certificates/dashboard-key.pem
      - wazuh-certificates/admin.pem
      - wazuh-certificates/admin-key.pem
      - wazuh-certificates/server.pem
      - wazuh-certificates/server-key.pem

  - name: dashboard-certs
    files:
      - wazuh-certificates/dashboard.pem
      - wazuh-certificates/dashboard-key.pem
      - wazuh-certificates/root-ca.pem

configMapGenerator:
  # ðŸ”¹ðŸ”¹ðŸ”¹ ADDED (Indexer security config â€“ REQUIRED) ðŸ”¹ðŸ”¹ðŸ”¹
  - name: indexer-security-config
    files:
      - indexer_stack/wazuh-indexer/securityconfig/config.yml
      - indexer_stack/wazuh-indexer/securityconfig/internal_users.yml
      - indexer_stack/wazuh-indexer/securityconfig/roles.yml
      - indexer_stack/wazuh-indexer/securityconfig/roles_mapping.yml
      - indexer_stack/wazuh-indexer/securityconfig/action_groups.yml
      - indexer_stack/wazuh-indexer/securityconfig/whitelist.yml 
      - indexer_stack/wazuh-indexer/securityconfig/nodes_dn.yml

  # ðŸ”¹ EXISTING DASHBOARD CONFIG (UNCHANGED)
  - name: dashboard-config
    files:
      - indexer_stack/wazuh-dashboard/dashboard_conf/opensearch_dashboards.yml

generatorOptions:
  disableNameSuffixHash: true
